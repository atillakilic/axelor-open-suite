<?xml version="1.0" encoding="UTF-8" standalone="yes"?>
<object-views xmlns="http://axelor.com/xml/ns/object-views"
  xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
  xsi:schemaLocation="http://axelor.com/xml/ns/object-views http://axelor.com/xml/ns/object-views/object-views_5.4.xsd">

  <grid name="employee-file-grid" title="Files" model="com.axelor.apps.hr.db.EmployeeFile">
    <menubar>
      <menu name="employeeFileReportsMenu" title="Reports" icon="fa-files-o" showTitle="true">
        <item name="printItem2" title="Doc Report"
          action="action-emoloyee-file-print-docexpiration-date-report"/>
      </menu>
    </menubar>
    <hilite background="danger"
      if="$moment(expirationDate).diff(todayDate,'days') &lt;= criticalTime"/>
    <hilite background="warning"
      if="$moment(expirationDate).diff(todayDate,'days') &lt;= preparationTime"/>
    <field name="name"/>
    <field name="employee" hidden="true"/>
    <field name="employeeHr"/>
    <field name="employeeHr.employeeNationality"/>
    <field name="fileType"/>
    <field name="metaFile"/>
    <field name="expirationDate"/>
    <field name="remainingDays"/>
    <field name="preparationTime"/>
    <field name="criticalTime"/>
    <field name="notFollowDoc"/>
    <field name="price" canEdit="true"/>
  </grid>
  
  <grid name="employee-file-dashboard-grid" title="Files" model="com.axelor.apps.hr.db.EmployeeFile">
    <menubar>
      <menu name="employeeFileReportsMenu" title="Reports" icon="fa-files-o" showTitle="true">
        <item name="printItem2" title="Doc Report"
          action="action-emoloyee-file-print-docexpiration-date-report"/>
      </menu>
    </menubar>
    <hilite background="danger"
      if="$moment(expirationDate).diff(todayDate,'days') &lt;= criticalTime"/>
    <hilite background="warning"
      if="$moment(expirationDate).diff(todayDate,'days') &lt;= preparationTime"/>
    <field name="name"/>
    <field name="employee" hidden="true"/>
    <field name="employeeHr"/>
    <field name="employeeHr.employeeNationality"/>
    <field name="fileType"/>
    <field name="metaFile"/>
    <field name="expirationDate"/>
    <field name="remainingDays"/>
    <field name="preparationTime"/>
    <field name="criticalTime"/>
    <field name="notFollowDoc"/>
    <field name="price" canEdit="true"/>
  </grid>

  <form name="employee-file-form" title="File" model="com.axelor.apps.hr.db.EmployeeFile"
    onNew="action-employee-file-attrs-on-new-set-file-type,action-employee-file-attrs-on-new-set-records">
    <panel name="mainPanel">
      <field name="name" colSpan="4" readonly="true"/>
      <field name="employeeHr" colSpan="4" readonly="true"/>
      <field name="employee" hidden="true" colSpan="4" readonly="true"/>
      <field name="fileType" colSpan="3"
        onChange="action-record-set-expiration-date,action-employee-file-attrs-on-new-set-records"/>
      <field name="metaFile" widget="binary-link" colSpan="3" required="true"
        onChange="action-record-set-record-date"/>
      <field name="recordDate" colSpan="3" readonly="true"/>
      <field name="expirationDate" showIf="fileType.hasExpirationDate" colSpan="3"
        requiredIf="fileType.hasExpirationDate"
        onChange="action-employee-file-record-calcuate-remain-day"/>
      <field name="notFollowDoc"/>
      <field name="preparationTime" colSpan="3" readonly="true" hidden="true"/>
      <field name="remainingDays" title="Remaining Days" colSpan="4" readonly="true"
        hidden="true"/>
      <field name="criticalTime" colSpan="3" readonly="true" hidden="true"/>
      <field name="price" colSpan="3" readonly="true" hidden="true"/>
      <field name="fileType.hasExpirationDate" hidden="true"/>
    </panel>

  </form>


  <form name="employee-file-form-wizard" model="com.axelor.apps.base.db.Wizard"
    title="Select ExpirationDate Range" width="large">
    <panel>
      <field name="$startDate" type="date" title="Start Date" required="true"/>
      <field name="$endDate" type="date" title="End Date" required="true"/>
      <button name="printEmployeeDocReport" title="Print"
        onClick="action-emoloyee-file-print-docexpiration-date-report,close"/>
    </panel>
  </form>

  <action-record name="action-record-set-record-date"
    model="com.axelor.apps.hr.db.EmployeeFile">
    <field name="recordDate" expr="eval: metaFile?__config__.date:null"/>
  </action-record>

  <action-record name="action-record-set-expiration-date"
    model="com.axelor.apps.hr.db.EmployeeFile">
    <field name="expirationDate" expr="eval: null" if="!fileType?.hasExpirationDate"/>
    <field name="preparationTime" expr="eval: fileType?.preparationTime"/>
  </action-record>

  <action-view name="action-employee-file-view-reports-wizard"
    title="Select ExpirationDate Range" model="com.axelor.apps.base.db.Wizard">
    <view type="form" name="employee-file-form-wizard"/>
    <view-param name="popup" value="reload"/>
    <view-param name="popup-save" value="false"/>
    <view-param name="show-toolbar" value="false"/>
    <view-param name="show-confirm" value="false"/>
  </action-view>

  <action-method name="action-emoloyee-file-print-docexpiration-date-report">
    <call class="com.axelor.apps.hr.web.EmployeeFileController"
      method="printExpeirationDateReport"/>
  </action-method>

  <action-method name="action-employee-file-record-calcuate-remain-day">
    <call class="com.axelor.apps.hr.web.EmployeeFileController" method="calculateRemainingDays"/>
  </action-method>

  <action-attrs name="action-employee-file-attrs-on-new-set-file-type">

    <attribute name="value" for="fileType"
      if="_parent != null &amp;&amp; _parent._model == 'com.axelor.apps.hr.db.EmployeePassport'"
      expr="eval:__repo__(FileType).all()filter('self.code = ?','Passport').fetchOne()"/>

    <attribute name="value" for="name"
      if="_parent != null &amp;&amp; _parent._model == 'com.axelor.apps.hr.db.EmployeePassport'"
      expr="eval: _parent?._parent?.name +'-Passport' "/>

    <attribute name="value" for="fileType"
      if="_parent != null &amp;&amp; _parent._model == 'com.axelor.apps.hr.db.EmployeeVisa'"
      expr="eval:__repo__(FileType).all()filter('self.code = ?','Visa').fetchOne()"/>

    <attribute name="value" for="name"
      if="_parent != null &amp;&amp; _parent._model == 'com.axelor.apps.hr.db.EmployeeVisa'"
      expr="eval: _parent?._parent?.name +'-Visa' "/>

    <attribute name="value" for="fileType"
      if="_parent != null &amp;&amp; _parent._model == 'com.axelor.apps.hr.db.EmployeeWorkCard'"
      expr="eval:__repo__(FileType).all()filter('self.code = ?','Working Card').fetchOne()"/>

    <attribute name="value" for="name"
      if="_parent != null &amp;&amp; _parent._model == 'com.axelor.apps.hr.db.EmployeeWorkCard'"
      expr="eval: _parent?._parent?.name +'-Working Card' "/>

    <attribute name="value" for="fileType"
      if="_parent != null &amp;&amp; _parent._model == 'com.axelor.apps.hr.db.EmployeeLanguageCert'"
      expr="eval:__repo__(FileType).all()filter('self.code = ?','Language certificate').fetchOne()"/>

    <attribute name="value" for="name"
      if="_parent != null &amp;&amp; _parent._model == 'com.axelor.apps.hr.db.EmployeeLanguageCert'"
      expr="eval: _parent?._parent?.name +'-Language certificate' "/>

    <attribute name="value" for="fileType"
      if="_parent != null &amp;&amp; _parent._model == 'com.axelor.apps.hr.db.EmployeeMilitaryService'"
      expr="eval:__repo__(FileType).all()filter('self.code = ?','Military Service').fetchOne()"/>

    <attribute name="value" for="name"
      if="_parent != null &amp;&amp; _parent._model == 'com.axelor.apps.hr.db.EmployeeMilitaryService'"
      expr="eval: _parent?._parent?.name +'-Military Service' "/>

    <attribute name="value" for="fileType"
      if="_parent != null &amp;&amp; _parent._model == 'com.axelor.apps.hr.db.EmployeeMigrationCard'"
      expr="eval:__repo__(FileType).all()filter('self.code = ?','Migration Card').fetchOne()"/>

    <attribute name="value" for="name"
      if="_parent != null &amp;&amp; _parent._model == 'com.axelor.apps.hr.db.EmployeeMigrationCard'"
      expr="eval: _parent?._parent?.name +'-Migration Card' "/>

    <attribute name="value" for="fileType"
      if="_parent != null &amp;&amp; _parent._model == 'com.axelor.apps.hr.db.EmployeeVnj'"
      expr="eval:__repo__(FileType).all()filter('self.code = ?','VNJ').fetchOne()"/>

    <attribute name="value" for="name"
      if="_parent != null &amp;&amp; _parent._model == 'com.axelor.apps.hr.db.EmployeeVnj'"
      expr="eval: _parent?._parent?.name +'-VNJ' "/>

    <attribute name="value" for="fileType"
      if="_parent != null &amp;&amp; _parent._model == 'com.axelor.apps.hr.db.EmployeeRvp'"
      expr="eval:__repo__(FileType).all()filter('self.code = ?','RVP').fetchOne()"/>

    <attribute name="value" for="name"
      if="_parent != null &amp;&amp; _parent._model == 'com.axelor.apps.hr.db.EmployeeRvp'"
      expr="eval: _parent?._parent?.name +'-RVP' "/>

    <attribute name="value" for="fileType"
      if="_parent != null &amp;&amp; _parent._model == 'com.axelor.apps.hr.db.EmployeeDrivingLicense'"
      expr="eval:__repo__(FileType).all()filter('self.code = ?','Driving Licence').fetchOne()"/>

    <attribute name="value" for="name"
      if="_parent != null &amp;&amp; _parent._model == 'com.axelor.apps.hr.db.EmployeeDrivingLicense'"
      expr="eval: _parent?._parent?.name +'-Driving Licence' "/>

    <attribute name="value" for="employeeHr" expr="eval: _parent?._parent"/>

  </action-attrs>

  <action-attrs name="action-employee-file-attrs-on-new-set-records">
    <attribute name="value" for="preparationTime" expr="eval: fileType?.preparationTime"/>
    <attribute name="value" for="remainingDays" expr="eval: fileType?.criticalTime"/>
    <attribute name="value" for="criticalTime" expr="eval: fileType?.remainingDays"/>
    <attribute name="value" for="price" expr="eval: fileType?.price"/>
  </action-attrs>

</object-views>
